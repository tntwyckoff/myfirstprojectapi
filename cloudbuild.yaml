steps:
# Build all supported versions.
- name: 'gcr.io/cloud-builders/docker'
  args:
  - 'build'
  - '--tag=gcr.io/$PROJECT_ID/dockerbuilt'
  - '--file=Dockerfile'
  - '.'
  id: 'buildstep'

# Tag the latest version as :latest. We use gcr.io/cloud-builders/docker here
# and not gcr.io/$PROJECT_ID/docker because the latter may not yet exist.
- name: 'gcr.io/cloud-builders/docker'
  args: ['tag', 'gcr.io/$PROJECT_ID/dockerbuilt', 'gcr.io/$PROJECT_ID/latest']
  wait_for: ['buildstep']
  id: 'latest'

images:
- 'gcr.io/$PROJECT_ID/docker:dockerbuilt'